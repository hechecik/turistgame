<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>G & N: Neon Wars</title>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Montserrat:wght@900&display=swap');

    :root {
        --bg-color: #050505;
        --neon-g: #ff0055; /* G - Kırmızı */
        --neon-n: #ffcc00; /* N - Sarı */
        --neon-blue: #00f3ff;
        --glass: rgba(255, 255, 255, 0.08);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

    body {
        margin: 0; height: 100vh; width: 100vw; overflow: hidden;
        background: radial-gradient(circle at center, #1a0b1a 0%, #000 100%);
        color: #fff; font-family: 'Orbitron', sans-serif;
        display: flex; flex-direction: column; align-items: center;
    }

    /* --- MENÜ --- */
    #menu-layer {
        position: absolute; inset: 0; z-index: 2000;
        background: rgba(0,0,0,0.98);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
    }

    .title {
        font-size: 5rem; letter-spacing: 5px; margin-bottom: 10px;
        background: linear-gradient(90deg, var(--neon-g), var(--neon-n));
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 20px rgba(255, 0, 85, 0.5));
        text-align: center;
    }
    .subtitle { font-size: 1rem; color: #888; letter-spacing: 4px; margin-bottom: 50px; }

    .btn {
        padding: 20px; width: 80%; max-width: 300px; margin: 10px;
        border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold;
        cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase;
        transition: transform 0.1s;
    }
    .btn-create { background: var(--neon-blue); color: #000; box-shadow: 0 0 20px rgba(0,243,255,0.3); }
    .btn-local { background: transparent; border: 2px solid #444; color: #aaa; }
    .btn:active { transform: scale(0.95); }

    .link-area {
        display: none; flex-direction: column; align-items: center; gap: 15px; width: 90%; max-width: 400px;
        background: #111; padding: 25px; border-radius: 20px; border: 1px solid #333;
    }
    .link-input {
        width: 100%; padding: 15px; background: #000; border: 1px solid var(--neon-blue);
        color: var(--neon-blue); text-align: center; border-radius: 10px; font-family: monospace;
    }

    /* --- OYUN ALANI --- */
    #game-layer {
        display: none; flex-direction: column; align-items: center; width: 100%; height: 100%;
        padding-top: 20px;
    }

    .hud {
        display: flex; justify-content: space-between; align-items: center; width: 90%; max-width: 450px;
        background: var(--glass); padding: 15px 30px; border-radius: 50px;
        margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1);
    }
    .score-box { text-align: center; opacity: 0.5; transition: 0.3s; }
    .score-box.active { opacity: 1; transform: scale(1.1); filter: drop-shadow(0 0 10px currentColor); }
    .score-val { font-size: 2rem; display: block; }
    .c-g { color: var(--neon-g); } .c-n { color: var(--neon-n); }

    .board-wrap {
        position: relative; width: 90vmin; height: 90vmin; max-width: 400px; max-height: 400px;
        background: #111; border-radius: 20px;
        box-shadow: 0 0 50px rgba(0,0,0,0.5);
        border: 1px solid #333; margin-bottom: 20px;
        touch-action: none; /* Mobilde kaydırmayı engeller */
    }

    svg.lines { width: 100%; height: 100%; position: absolute; pointer-events: none; }
    line { stroke: #333; stroke-width: 4; stroke-linecap: round; }

    .spot {
        position: absolute; width: 25%; height: 25%;
        transform: translate(-50%, -50%); border-radius: 50%; z-index: 5;
    }

    /* TAŞLAR (G ve N) */
    .piece {
        position: absolute; width: 16%; height: 16%;
        border-radius: 50%; z-index: 10; cursor: grab;
        display: flex; align-items: center; justify-content: center;
        font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: 1.8rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.8);
        background: #1a1a1a; transition: transform 0.1s;
    }
    .piece:active { transform: scale(1.2); }
    
    .piece.red { border: 2px solid var(--neon-g); color: var(--neon-g); text-shadow: 0 0 15px var(--neon-g); }
    .piece.red::after { content: 'G'; }

    .piece.yellow { border: 2px solid var(--neon-n); color: var(--neon-n); text-shadow: 0 0 15px var(--neon-n); }
    .piece.yellow::after { content: 'N'; }

    .pools { display: flex; width: 90%; max-width: 400px; justify-content: space-between; height: 15%; }
    .pool { width: 45%; background: var(--glass); border-radius: 15px; position: relative; }

    /* Modallar */
    .modal {
        position: fixed; inset: 0; background: rgba(0,0,0,0.95);
        display: none; align-items: center; justify-content: center; z-index: 3000;
        flex-direction: column; gap: 20px;
    }
    .modal h2 { font-size: 2.5rem; margin: 0; }
    .toast {
        position: fixed; top: 20px; background: #222; color: var(--neon-blue); padding: 10px 20px;
        border-radius: 20px; opacity: 0; transition: 0.3s; border: 1px solid var(--neon-blue);
    }
</style>
</head>
<body>

    <div id="menu-layer">
        <div class="title">G & N</div>
        <div class="subtitle">SONSUZ DÜELLO</div>
        
        <div id="main-btns" style="display:flex; flex-direction:column; align-items:center; width:100%">
            <button class="btn btn-create" id="btn-online">Link Oluştur</button>
            <button class="btn btn-local" id="btn-local">İnternetsiz Oyna</button>
        </div>

        <div class="link-area" id="link-area">
            <p style="color:#aaa; margin:0">Bu linki rakibine at:</p>
            <input class="link-input" id="share-link" readonly value="Bağlanıyor...">
            <button class="btn btn-create" id="btn-copy" style="padding:15px; font-size:1rem; width:100%">Kopyala</button>
            <p id="status-msg" style="color:var(--neon-n); margin-top:10px">Rakip Bekleniyor...</p>
        </div>
    </div>

    <div id="game-layer">
        <div class="hud">
            <div class="score-box c-g" id="p1-stat"><span class="score-val" id="s1">0</span><small>G TAKIMI</small></div>
            <div style="font-size:0.8rem; color:#666" id="turn-text">VS</div>
            <div class="score-box c-n" id="p2-stat"><span class="score-val" id="s2">0</span><small>N TAKIMI</small></div>
        </div>

        <div class="board-wrap" id="board">
            <svg class="lines">
                <line x1="10%" y1="10%" x2="90%" y2="10%"/><line x1="90%" y1="10%" x2="90%" y2="90%"/>
                <line x1="90%" y1="90%" x2="10%" y2="90%"/><line x1="10%" y1="90%" x2="10%" y2="10%"/>
                <line x1="50%" y1="10%" x2="50%" y2="90%"/><line x1="10%" y1="50%" x2="90%" y2="50%"/>
                <line x1="10%" y1="10%" x2="90%" y2="90%"/><line x1="90%" y1="10%" x2="10%" y2="90%"/>
            </svg>
        </div>

        <div class="pools">
            <div class="pool" id="pool-R"></div>
            <div class="pool" id="pool-Y"></div>
        </div>
    </div>

    <div class="modal" id="end-modal">
        <h2 id="end-msg">KAZANDIN!</h2>
        <button class="btn btn-create" id="btn-next">Sonraki Tur</button>
    </div>

    <div class="modal" id="disc-modal">
        <h2 style="color:#888; font-size:1.5rem">Rakip Ayrıldı</h2>
        <button class="btn btn-create" onclick="location.reload()">Yeni Link Al</button>
    </div>

    <div class="toast" id="toast">Kopyalandı!</div>

<script>
    /* --- AYARLAR --- */
    const pos = [{l:10,t:10},{l:50,t:10},{l:90,t:10},{l:10,t:50},{l:50,t:50},{l:90,t:50},{l:10,t:90},{l:50,t:90},{l:90,t:90}];
    const adj = [[1,3,4],[0,2,4],[1,5,4],[0,4,6],[0,1,2,3,5,6,7,8],[2,4,8],[3,4,7],[6,4,8],[4,5,7]];
    const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

    let mode = 'local';
    let myRole = 'both';
    let state = { board:Array(9).fill(null), turn:'R', phase:'placing', placed:{R:0,Y:0}, score:{R:0,Y:0}, winner:null };
    let peer = null, conn = null;

    /* --- YÜKLEME --- */
    window.onload = () => {
        createSpots();
        
        // Butonları Bağla
        document.getElementById('btn-local').onclick = startLocal;
        document.getElementById('btn-online').onclick = initHost;
        document.getElementById('btn-copy').onclick = copyLink;
        document.getElementById('btn-next').onclick = nextRound;

        // Link ile gelindiyse
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('id')) initJoin(urlParams.get('id'));
    };

    function createSpots() {
        const board = document.getElementById('board');
        pos.forEach((p,i)=>{
            let s = document.createElement('div');
            s.className='spot'; s.style.left=p.l+'%'; s.style.top=p.t+'%'; s.dataset.idx=i;
            board.appendChild(s);
        });
    }

    /* --- BAŞLATMA FONKSİYONLARI --- */
    function startLocal() {
        mode = 'local';
        myRole = 'both';
        document.getElementById('menu-layer').style.display='none';
        document.getElementById('game-layer').style.display='flex';
        render();
    }

    function initHost() {
        if(typeof Peer === 'undefined') { alert("İnternet bağlantısı yok!"); return; }
        
        document.getElementById('main-btns').style.display='none';
        document.getElementById('link-area').style.display='flex';

        peer = new Peer(null, {debug:1});
        peer.on('open', id => {
            document.getElementById('share-link').value = window.location.origin + window.location.pathname + '?id=' + id;
        });
        peer.on('connection', c => {
            conn = c; setupConn();
            myRole = 'R';
            document.getElementById('status-msg').innerText = "BAĞLANDI!";
            setTimeout(() => {
                document.getElementById('menu-layer').style.display='none';
                document.getElementById('game-layer').style.display='flex';
                sendState(); render();
            }, 1000);
        });
        peer.on('error', err => alert("Bağlantı Hatası: " + err));
    }

    function initJoin(id) {
        document.getElementById('main-btns').style.display='none';
        const msg = document.createElement('div');
        msg.innerText = "ODAYA KATILINIYOR...";
        msg.style.color = "var(--neon-blue)"; msg.style.marginTop="20px";
        document.getElementById('menu-layer').appendChild(msg);

        peer = new Peer(null, {debug:1});
        peer.on('open', () => {
            conn = peer.connect(id);
            setupConn();
        });
        peer.on('error', () => { alert("Link geçersiz veya oda kapalı."); window.location.href = window.location.pathname; });
    }

    function setupConn() {
        conn.on('open', () => console.log("Bağlı"));
        conn.on('data', d => {
            if(d.type === 'state') {
                state = d.val;
                if(mode === 'local') { mode='online'; myRole='Y'; }
                document.getElementById('menu-layer').style.display='none';
                document.getElementById('game-layer').style.display='flex';
                render();
            } else if (d.type === 'next') {
                resetLogic();
                render();
            }
        });
        conn.on('close', () => document.getElementById('disc-modal').style.display='flex');
    }

    /* --- OYUN MANTIĞI --- */
    function nextRound() {
        if(mode === 'local') {
            resetLogic();
            render();
        } else {
            conn.send({type: 'next'});
            resetLogic();
            sendState();
            render();
        }
    }

    function resetLogic() {
        state.board.fill(null);
        state.phase = 'placing';
        state.placed = {R:0, Y:0};
        state.winner = null;
        state.turn = 'R'; // Her tur G başlar
        document.getElementById('end-modal').style.display='none';
    }

    function sendState() { if(conn && conn.open) conn.send({type:'state', val:state}); }

    function render() {
        // Skorlar
        document.getElementById('s1').innerText = state.score.R;
        document.getElementById('s2').innerText = state.score.Y;
        
        // Sıra Göstergesi
        document.getElementById('p1-stat').classList.toggle('active', state.turn==='R');
        document.getElementById('p2-stat').classList.toggle('active', state.turn==='Y');
        
        let txt = "";
        if(mode === 'online') txt = (state.turn === myRole) ? "S
