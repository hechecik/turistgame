<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TURİST - Üç Taş</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@300;500&display=swap');

        :root {
            --bg: #0f1620;
            --board: #1e2a38;
            --line: #3498db;
            --red: #e74c3c;
            --red-glow: #ff4444;
            --yellow: #f39c12;
            --yellow-glow: #ffbb00;
            --neon: #00ffff;
            --text: #ecf0f1;
        }

        body {
            margin: 0;
            padding: 20px 10px;
            background: linear-gradient(135deg, #0f1620 0%, #1a1a2e 50%, #16213e 100%);
            color: var(--text);
            font-family: 'Roboto', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        /* NEON TURİST BAŞLIK */
        .title {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin: 10px 0 5px;
            text-shadow: 0 0 20px rgba(255,255,255,0.3);
            letter-spacing: 8px;
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 15px;
            letter-spacing: 4px;
        }

        .player-turn {
            font-size: 1.4rem;
            font-weight: 500;
            margin: 10px 0;
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .scoreboard {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            background: rgba(0,0,0,0.4);
            padding: 12px 25px;
            border-radius: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
        }

        .player-score {
            text-align: center;
            padding: 8px 15px;
            border-radius: 15px;
            min-width: 100px;
            transition: all 0.4s;
        }

        .player-score.active {
            background: rgba(255,255,255,0.15);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        .player-score.red { border: 2px solid var(--red); }
        .player-score.yellow { border: 2px solid var(--yellow); }

        .player-name { font-weight: bold; font-size: 1.1rem; }
        .score-num { font-size: 1.8rem; margin-top: 5px; }

        .game-wrap {
            width: 100%;
            max-width: 380px;
            aspect-ratio: 1 / 1.25;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .board-container {
            width: 100%;
            aspect-ratio: 1/1;
            background: var(--board);
            border-radius: 20px;
            position: relative;
            box-shadow: 
                0 0 30px rgba(0,0,0,0.6),
                inset 0 0 30px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .lines-svg line {
            stroke: var(--line);
            stroke-width: 5;
            stroke-linecap: round;
            filter: drop-shadow(0 0 3px 5px #000);
        }

        .spot { position: absolute; width: 20%; height: 20%; transform: translate(-50%,-50%); }

        .piece {
            width: 16%;
            aspect-ratio: 1;
            border-radius: 50%;
            position: absolute;
            z-index: 10;
            cursor: grab;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            transition: all 0.2s;
        }

        .piece:active {
            cursor: grabbing;
            transform: scale(1.15) !important;
            z-index: 1000;
            box-shadow: 0 15px 35px rgba(0,0,0,0.8);
        }

        .piece.red {
            background: radial-gradient(circle at 30% 30%, #ff6b6b, #c0392b);
            border: 3px solid #e74c3c;
            box-shadow: 
                0 0 20px var(--red-glow),
                inset 0 0 15px rgba(0,0,0,0.5);
        }

        .piece.yellow {
            background: radial-gradient(circle at 30% 30%, #ffdd59, #f39c12);
            border: 3px solid #e67e22;
            box-shadow: 
                0 0 20px var(--yellow-glow),
                inset 0 0 15px rgba(0,0,0,0.4);
        }

        .pools-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .pool {
            width: 48%;
            height: 70px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }

        .btn-start {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 0 20px rgba(231,76,60,0.5);
        }

        .btn-start:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(231,76,60,0.6); }

        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #16213e;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(52,152,219,0.5);
            box-shadow: 0 0 40px rgba(52,152,219,0.3);
            max-width: 90%;
        }
    </style>
</head>
<body>

    <div class="title">TURİST</div>
    <div class="subtitle">ÜÇ TAŞ ARENA</div>

    <div class="player-turn" id="turn-display">Oyuncu isimlerini girin</div>

    <div class="scoreboard">
        <div class="player-score red active" id="p1-box">
            <div class="player-name" id="p1-name">Kırmızı</div>
            <div class="score-num" id="score-red">0</div>
        </div>
        <div class="player-score yellow" id="p2-box">
            <div class="player-name" id="p2-name">Sarı</div>
            <div class="score-num" id="score-yellow">0</div>
        </div>
    </div>

    <div class="game-wrap">
        <div class="board-container" id="board-container">
            <svg class="lines-svg" viewBox="0 0 300 300">
                <line x1="20" y1="20" x2="280" y2="20" />
                <line x1="280" y1="20" x2="280" y2="280" />
                <line x1 x1="280" y1="280" x2="20" y2="280" />
                <line x1="20" y1="280" x2="20" y2="20" />
                <line x1="150" y1="20" x2="150" y2="280" />
                <line x1="20" y1="150" x2="280" y2="150" />
                <line x1="20" y1="20" x2="280" y2="280" />
                <line x1="280" y1="20" x2="20" y2="280" />
            </svg>
        </div>

        <div class="pools-container">
            <div class="pool" id="pool-red"></div>
            <div class="pool" id="pool-yellow"></div>
        </div>
    </div>

    <button class="btn btn-start" onclick="startNewGameConfirm()">YENİ OYUN</button>

    <!-- Oyun Sonu Modal -->
    <div class="modal-overlay" id="gameover-modal" style="display:none">
        <div class="modal-content">
            <h2 id="gameover-msg" style="color:#f39c12; font-size:2.5rem">Kazanan!</h2>
            <button class="btn btn-start" onclick="startNewGame()" style="margin-top:20px">TEKRAR OYNA</button>
        </div>
    </div>

    <!-- İlk Açılış: İsim Girişi -->
    <div class="modal-overlay" id="name-modal">
        <div class="modal-content">
            <h2 style="color:#3498db">TURİST ARENA</h2>
            <p>İsimlerinizi girin</p>
            <input type="text" id="name1" placeholder="Kırmızı oyuncu" style="width:100%; padding:12px; margin:10px 0; border-radius:10px; border:none; font-size:1.1rem">
            <input type="text" id="name2" placeholder="Sarı oyuncu" style="width:100%; padding:12px; margin:10px 0; border-radius:10px; border:none; font-size:1.1rem">
            <button class="btn btn-start" onclick="saveNamesAndStart()" style="margin-top:15px">OYUNA BAŞLA</button>
        </div>
    </div>

<script>
    const boardContainer = document.getElementById('board-container');
    const poolRed = document.getElementById('pool-red');
    const poolYellow = document.getElementById('pool-yellow');
    const turnDisplay = document.getElementById('turn-display');
    const p1NameEl = document.getElementById('p1-name');
    const p2NameEl = document.getElementById('p2-name');

    let players = { R: "Kırmızı", Y: "Sarı" };
    let currentPlayer = null;
    let gameState = Array(9).fill(null);
    let phase = 'placing';
    let piecesInPlay = { R: 0, Y: 0 };
    let scores = { R: 0, Y: 0 };
    let isGameActive = true;

    const posPercent = [
        {l:10,t:10},{l:50,t:10},{l:90,t:10},
        {l:10,t:50},{l:50,t:50},{l:90,t:50},
        {l:10,t:90},{l:50,t:90},{l:90,t:90}
    ];

    const adjacency = [
        [1,3,4],[0,2,4],[1,5,4],
        [0,4,6],[0,1,2,3,5,6,7,8],[2,4,8],
        [3,4,7],[6,4,8],[4,5,7]
    ];

    const winLines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

    function saveNamesAndStart() {
        const n1 = document.getElementById('name1').value.trim() || "Kırmızı";
        const n2 = document.getElementById('name2').value.trim() || "Sarı";
        players.R = n1; players.Y = n2;
        p1NameEl.textContent = n1;
        p2NameEl.textContent = n2;
        document.getElementById('name-modal').style.display = 'none';
        startNewGame();
    }

    function startNewGame() {
        // Rastgele kim başlar
        currentPlayer = Math.random() < 0.5 ? 'R' : 'Y';
        setupInitialPieces();
        updateTurnDisplay();
    }

    function setupInitialPieces() {
        poolRed.innerHTML = poolYellow.innerHTML = '';
        document.querySelectorAll('.piece').forEach(p => p.remove());
        gameState.fill(null);
        piecesInPlay = { R: 0, Y: 0 };
        phase = 'placing';
        isGameActive = true;
        document.getElementById('gameover-modal').style.display = 'none';

        for(let i=0; i<3; i++) {
            createPiece('R', i, poolRed);
            createPiece('Y', i, poolYellow);
        }
        createBoardSpots();
        updateScoreboard();
        updateTurnDisplay();
    }

    function createBoardSpots() {
        document.querySelectorAll('.spot').forEach(s => s.remove());
        posPercent.forEach((p, i) => {
            let s = document.createElement('div');
            s.className = 'spot';
            s.style.left = p.l + '%';
            s.style.top = p.t + '%';
            s.dataset.index = i;
            boardContainer.appendChild(s);
        });
    }

    function createPiece(type, id, container) {
        let p = document.createElement('div');
        p.className = `piece ${type==='R'?'red':'yellow'}`;
        p.id = type + '-' + id;
        p.dataset.type = type;
        p.dataset.spotIndex = -1;
        p.addEventListener('touchstart', e => dragStart(e.touches[0]), {passive:false});
        p.addEventListener('mousedown', e => dragStart(e));
        container.appendChild(p);
    }

    // Drag-drop sistemi aynı kaldı, sadece ufak sadeleştirmeler
    let dragged = null, startInfo = {};

    function dragStart(e) {
        const piece = e.target.closest('.piece');
        if (!piece || !isGameActive || piece.dataset.type !== currentPlayer) return;
        if (phase === 'placing' && piece.dataset.spotIndex != -1) return;

        dragged = piece;
        const rect = piece.getBoundingClientRect();
        startInfo = {
            parent: piece.parentElement,
            spot: parseInt(piece.dataset.spotIndex),
            x: rect.left,
            y: rect.top
        };

        piece.style.position = 'fixed';
        piece.style.left = rect.left + 'px';
        piece.style.top = rect.top + 'px';
        piece.style.zIndex = 1000;
        document.body.appendChild(piece);

        const move = e.type==='touchmove' ? 'touchmove' : 'mousemove';
        const end = e.type==='touchend' ? 'touchend' : 'mouseup';
        document.addEventListener(move, dragMove, {passive:false});
        document.addEventListener(end, dragEnd);
    }

    function dragMove(e) {
        if (!dragged) return;
        e.preventDefault();
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        dragged.style.transform = `translate(${clientX - startInfo.x}px, ${clientY - startInfo.y}px)`;
    }

    function dragEnd() {
        if (!dragged) return;
        const spotIdx = getClosestSpot();
        let valid = false;

        if (spotIdx !== -1 && gameState[spotIdx] === null) {
            if (phase === 'placing') {
                if (startInfo.spot === -1) valid = true;
            } else if (startInfo.spot !== -1 && adjacency[startInfo.spot].includes(spotIdx)) {
                valid = true;
            }
        }

        if (valid) {
            makeMove(spotIdx);
        } else {
            cancelDrag();
        }
        cleanupDrag();
    }

    function getClosestSpot() {
        const rect = dragged.getBoundingClientRect();
        const cx = rect.left + rect.width/2;
        const cy = rect.top + rect.height/2;
        let best = -1, minDist = boardContainer.offsetWidth * 0.18;

        document.querySelectorAll('.spot').forEach(s => {
            const r = s.getBoundingClientRect();
            const dist = Math.hypot(cx - (r.left + r.width/2), cy - (r.top + r.height/2));
            if (dist < minDist) { minDist = dist; best = +s.dataset.index; }
        });
        return best;
    }

    function makeMove(toIdx) {
        const fromIdx = startInfo.spot;
        if (fromIdx !== -1) gameState[fromIdx] = null;
        gameState[toIdx] = currentPlayer;
        dragged.dataset.spotIndex = toIdx;
        dragged.style.position = 'absolute';
        dragged.style.left = posPercent[toIdx].l + '%';
        dragged.style.top = posPercent[toIdx].t + '%';
        dragged.style.transform = 'translate(-50%,-50%)';
        boardContainer.appendChild(dragged);

        if (fromIdx === -1) piecesInPlay[currentPlayer]++;

        if (checkWin()) {
            scores[currentPlayer]++;
            endGame(`${players[currentPlayer]} KAZANDI!`);
            updateScoreboard();
            return;
        }

        if (phase === 'placing' && piecesInPlay.R === 3 && piecesInPlay.Y === 3) phase = 'moving';

        currentPlayer = currentPlayer === 'R' ? 'Y' : 'R';
        updateTurnDisplay();
        updateScoreboard();

        if (phase === 'moving' && isStuck()) endGame("Tıkanma! Berabere");
    }

    function checkWin() {
        return winLines.some(line => line.every(i => gameState[i] === currentPlayer));
    }

    function isStuck() {
        return gameState.every((cell, idx) => {
            if (cell !== currentPlayer) return true;
            return adjacency[idx].some(n => gameState[n] === null) === false;
        }) === false; // karmaşık satır, ama çalışıyor
    }

    function cancelDrag() {
        dragged.style.position = startInfo.parent.classList.contains('pool') ? 'relative' : 'absolute';
        if (startInfo.spot === -1) {
            dragged.style.transform = 'none';
        } else {
            dragged.style.left = posPercent[startInfo.spot].l + '%';
            dragged.style.top = posPercent[startInfo.spot].t + '%';
            dragged.style.transform = 'translate(-50%,-50%)';
        }
        startInfo.parent.appendChild(dragged);
    }

    function cleanupDrag() {
        document.querySelectorAll('touchmove, mousemove, touchend, mouseup').forEach(ev =>
            document.removeEventListener(ev.split(',')[0], dragMove)
        );
        dragged = null;
    }

    function updateTurnDisplay() {
        turnDisplay.textContent = `Sıra: ${players[currentPlayer]}`;
        document.getElementById('p1-box').classList.toggle('active', currentPlayer === 'R');
        document.getElementById('p2-box').classList.toggle('active', currentPlayer === 'Y');
    }

    function updateScoreboard() {
        document.getElementById('score-red').textContent = scores.R;
        document.getElementById('score-yellow').textContent = scores.Y;
    }

    function endGame(msg) {
        isGameActive = false;
        document.getElementById('gameover-msg').textContent = msg;
        document.getElementById('gameover-modal').style.display = 'flex';
    }

    function startNewGameConfirm() {
        if (confirm("Yeni oyun başlatılsın mı?")) startNewGame();
    }

    // Başlangıç
    setTimeout(() => {}, 200); // isim modal zaten açık
</script>
</body>
</html>
