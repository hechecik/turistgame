<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Üç Taş Oyunu (Three Men's Morris)</title>
    <style>
        :root {
            --bg-color: #2c3e50;
            --board-color: #ecf0f1;
            --line-color: #34495e;
            --p1-color: #e74c3c; /* Kırmızı */
            --p2-color: #f1c40f; /* Sarı/Altın */
            --ui-bg: rgba(0, 0, 0, 0.8);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            overflow: hidden;
        }

        h1 { margin: 10px 0; font-size: 1.5rem; }

        /* Skor Tablosu */
        .scoreboard {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
        }
        .active-turn { text-decoration: underline; font-weight: bold; }
        .p1-score { color: var(--p1-color); }
        .p2-score { color: var(--p2-color); }

        /* Oyun Alanı Konteyner */
        .game-container {
            position: relative;
            width: 320px;
            height: 450px; /* Taş havuzları için ekstra alan */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Oyun Tahtası (Çizgiler) */
        .board {
            width: 300px;
            height: 300px;
            position: relative;
            background-color: var(--board-color);
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        /* Çizgileri SVG ile çiziyoruz */
        .lines {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
        }
        line {
            stroke: var(--line-color);
            stroke-width: 5;
            stroke-linecap: round;
        }

        /* Noktalar (Drop Zones) */
        .spot {
            width: 60px;
            height: 60px;
            position: absolute;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            cursor: pointer;
            /* Debug için border açılabilir: border: 1px solid red; */
        }

        /* Taşlar */
        .piece {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: absolute;
            z-index: 20;
            cursor: grab;
            transition: transform 0.1s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .piece:active { cursor: grabbing; transform: scale(1.1); }
        
        .piece.red { 
            background: radial-gradient(circleAt 30% 30%, #ff7b7b, var(--p1-color));
            border: 2px solid #c0392b;
        }
        .piece.yellow { 
            background: radial-gradient(circle at 30% 30%, #ffeead, var(--p2-color));
            border: 2px solid #f39c12;
            /* Yıldız şekli efekti için (basit tutuldu, CSS ile şekil verilebilir ama yuvarlak daha iyi oynanış sağlar) */
        }
        .piece.yellow::after {
            content: "★";
            color: #d35400;
            font-size: 30px;
        }

        /* Kenardaki Taş Havuzları */
        .pool {
            display: flex;
            justify-content: center;
            gap: 10px;
            height: 60px;
            width: 100%;
            margin-top: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            align-items: center;
        }

        /* Menü / Butonlar */
        .controls {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 5px;
            background-color: #3498db;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover { background-color: #2980b9; }

        /* Mesaj Alanı */
        .message {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: var(--ui-bg);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 100;
            backdrop-filter: blur(5px);
        }
        .message h2 { margin-top: 0; }

    </style>
</head>
<body>

    <h1>Üç Taş (Three Men's Morris)</h1>

    <div class="scoreboard">
        <div id="p1-display" class="p1-score active-turn">Kırmızı: <span id="score-red">0</span></div>
        <div id="p2-display" class="p2-score">Sarı: <span id="score-yellow">0</span></div>
    </div>

    <div class="game-container">
        <div class="board" id="board">
            <svg class="lines">
                <line x1="20" y1="20" x2="280" y2="20" />
                <line x1="20" y1="150" x2="280" y2="150" />
                <line x1="20" y1="280" x2="280" y2="280" />
                <line x1="20" y1="20" x2="20" y2="280" />
                <line x1="150" y1="20" x2="150" y2="280" />
                <line x1="280" y1="20" x2="280" y2="280" />
                <line x1="20" y1="20" x2="280" y2="280" />
                <line x1="280" y1="20" x2="20" y2="280" />
            </svg>
            
            </div>

        <div class="pool" id="pool-red"></div>
        <div class="pool" id="pool-yellow"></div>
    </div>

    <div class="controls">
        <button onclick="resetGame()">Yeni Oyun Başlat</button>
    </div>

    <div class="message" id="modal">
        <h2 id="modal-msg">Oyun Bitti!</h2>
        <button onclick="resetGame()">Tekrar Oyna</button>
    </div>

<script>
    // --- OYUN AYARLARI VE DEĞİŞKENLER ---
    const boardEl = document.getElementById('board');
    const poolRed = document.getElementById('pool-red');
    const poolYellow = document.getElementById('pool-yellow');
    const modal = document.getElementById('modal');
    const modalMsg = document.getElementById('modal-msg');
    
    // Oyun Durumu
    let gameState = Array(9).fill(null); // 0-8 arası, 'R' veya 'Y' tutar
    let currentPlayer = 'R'; // R: Red, Y: Yellow
    let phase = 'placing'; // 'placing' (yerleştirme) veya 'moving' (hareket)
    let piecesPlaced = { R: 0, Y: 0 };
    let scores = { R: 0, Y: 0 };
    let isGameOver = false;

    // Koordinatlar (px cinsinden, 300x300 board için)
    // Sol üst (20,20), Orta (150,150), Sağ Alt (280,280)
    const positions = [
        {x: 20, y: 20},  {x: 150, y: 20},  {x: 280, y: 20},
        {x: 20, y: 150}, {x: 150, y: 150}, {x: 280, y: 150},
        {x: 20, y: 280}, {x: 150, y: 280}, {x: 280, y: 280}
    ];

    // Komşuluk Listesi (Hangi noktadan hangisine gidilebilir)
    const adjacency = [
        [1, 3, 4],       // 0
        [0, 2, 4],       // 1
        [1, 5, 4],       // 2 (Dikkat: 2-4 çapraz bağlantı görselde var)
        [0, 4, 6],       // 3
        [0, 1, 2, 3, 5, 6, 7, 8], // 4 (Merkez her yere bağlı)
        [2, 4, 8],       // 5
        [3, 4, 7],       // 6
        [6, 4, 8],       // 7
        [4, 5, 7]        // 8
    ];
    // Not: Görseldeki çaprazlar sadece merkezden geçiyor gibi.
    // Klasik "Achi" veya "Three Men's Morris" varyasyonuna göre, merkez (4) her yere bağlıdır.
    // Köşeler merkeze ve yanlarına bağlıdır.

    // Kazanma Kombinasyonları
    const winLines = [
        [0,1,2], [3,4,5], [6,7,8], // Yatay
        [0,3,6], [1,4,7], [2,5,8], // Dikey
        [0,4,8], [2,4,6]           // Çapraz
    ];

    // --- BAŞLANGIÇ ---
    function init() {
        createSpots();
        createPieces();
        updateTurnDisplay();
    }

    // Tahta üzerindeki görünmez noktaları yarat (Drop zones)
    function createSpots() {
        positions.forEach((pos, index) => {
            let s = document.createElement('div');
            s.className = 'spot';
            s.style.left = pos.x + 'px';
            s.style.top = pos.y + 'px';
            s.dataset.index = index;
            boardEl.appendChild(s);
        });
    }

    // Taşları yarat (Havuzda başlarlar)
    function createPieces() {
        poolRed.innerHTML = '';
        poolYellow.innerHTML = '';
        
        for(let i=0; i<3; i++) createPiece('R', i);
        for(let i=0; i<3; i++) createPiece('Y', i);
    }

    function createPiece(type, id) {
        let p = document.createElement('div');
        p.className = `piece ${type === 'R' ? 'red' : 'yellow'}`;
        p.id = `${type}-${id}`;
        p.dataset.type = type;
        p.dataset.currentSpot = -1; // -1: Havuzda
        
        // Sürükleme Eventleri
        p.addEventListener('mousedown', dragStart);
        p.addEventListener('touchstart', dragStart, {passive: false});
        
        // Başlangıç konumu CSS ile pool içinde otomatik
        if(type === 'R') poolRed.appendChild(p);
        else poolYellow.appendChild(p);
    }

    // --- SÜRÜKLE BIRAK MANTIĞI ---
    let draggedPiece = null;
    let originalX, originalY, startX, startY;
    let originalParent = null;

    function dragStart(e) {
        if(isGameOver) return;
        
        const type = e.target.dataset.type;
        // Sadece sırası gelen oyuncu oynayabilir
        if(type !== currentPlayer) return;

        draggedPiece = e.target;
        
        // Yerleştirme aşaması kontrolü
        if(phase === 'placing' && parseInt(draggedPiece.dataset.currentSpot) !== -1) {
            // Yerleştirme aşamasındayız ama bu taş zaten sahada. Oynatamazsın.
            draggedPiece = null; 
            return;
        }

        // Dokunmatik veya Mouse koordinatları
        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

        // Orijinal pozisyonu kaydet (geri dönmek için)
        const rect = draggedPiece.getBoundingClientRect();
        originalX = rect.left;
        originalY = rect.top;
        startX = clientX;
        startY = clientY;
        originalParent = draggedPiece.parentElement;

        // Taşı body'e taşı ki her şeyin üstünde görünsün (z-index)
        // Ama önce boyutunu ve pozisyonunu koru
        draggedPiece.style.position = 'fixed';
        draggedPiece.style.left = originalX + 'px';
        draggedPiece.style.top = originalY + 'px';
        document.body.appendChild(draggedPiece);

        document.addEventListener('mousemove', dragMove);
        document.addEventListener('touchmove', dragMove, {passive: false});
        document.addEventListener('mouseup', dragEnd);
        document.addEventListener('touchend', dragEnd);
    }

    function dragMove(e) {
        if (!draggedPiece) return;
        e.preventDefault(); // Sayfa kaymasını engelle

        const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
        const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

        const deltaX = clientX - startX;
        const deltaY = clientY - startY;

        draggedPiece.style.left = (originalX + deltaX) + 'px';
        draggedPiece.style.top = (originalY + deltaY) + 'px';
    }

    function dragEnd(e) {
        if (!draggedPiece) return;

        document.removeEventListener('mousemove', dragMove);
        document.removeEventListener('touchmove', dragMove);
        document.removeEventListener('mouseup', dragEnd);
        document.removeEventListener('touchend', dragEnd);

        // Bırakılan yeri bul
        const droppedSpot = getClosestSpot(draggedPiece);
        
        let isValid = false;

        if (droppedSpot) {
            const spotIndex = parseInt(droppedSpot.dataset.index);
            const currentSpotIndex = parseInt(draggedPiece.dataset.currentSpot);

            // KURAL KONTROLLERİ
            // 1. Hedef boş mu?
            if (gameState[spotIndex] === null) {
                
                if (phase === 'placing') {
                    // Yerleştirme: Havuzdan mı geliyor?
                    if (currentSpotIndex === -1) {
                        isValid = true;
                    }
                } else if (phase === 'moving') {
                    // Hareket: Komşu mu?
                    if (currentSpotIndex !== -1 && adjacency[currentSpotIndex].includes(spotIndex)) {
                        isValid = true;
                    }
                }
            }

            if (isValid) {
                // HAMLE GEÇERLİ
                executeMove(draggedPiece, currentSpotIndex, spotIndex);
            }
        }

        if (!isValid) {
            // HAMLE GEÇERSİZ - GERİ DÖN
            returnToOriginal();
        }

        draggedPiece = null;
    }

    // Taşa en yakın spot'u bul (çarpışma testi)
    function getClosestSpot(piece) {
        const pieceRect = piece.getBoundingClientRect();
        const pieceCx = pieceRect.left + pieceRect.width / 2;
        const pieceCy = pieceRect.top + pieceRect.height / 2;

        const spots = document.querySelectorAll('.spot');
        let closest = null;
        let minDist = 50; // Yakalama yarıçapı

        spots.forEach(spot => {
            const rect = spot.getBoundingClientRect();
            const spotCx = rect.left + rect.width / 2;
            const spotCy = rect.top + rect.height / 2;
            
            const dist = Math.hypot(pieceCx - spotCx, pieceCy - spotCy);
            if (dist < minDist) {
                minDist = dist;
                closest = spot;
            }
        });
        return closest;
    }

    function returnToOriginal() {
        draggedPiece.style.position = 'absolute';
        if (originalParent.classList.contains('pool')) {
             // Havuza geri
             originalParent.appendChild(draggedPiece);
             draggedPiece.style.position = 'relative';
             draggedPiece.style.left = 'auto';
             draggedPiece.style.top = 'auto';
        } else {
            // Sahadaki eski yerine geri (board içine)
            boardEl.appendChild(draggedPiece);
            const oldIdx = parseInt(draggedPiece.dataset.currentSpot);
            draggedPiece.style.left = positions[oldIdx].x - 25 + 'px'; // -25 radius offset
            draggedPiece.style.top = positions[oldIdx].y - 25 + 'px';
        }
    }

    function executeMove(piece, fromIdx, toIdx) {
        // Mantıksal güncelleme
        if (fromIdx !== -1) gameState[fromIdx] = null;
        gameState[toIdx] = currentPlayer;
        piece.dataset.currentSpot = toIdx;

        // Görsel güncelleme
        boardEl.appendChild(piece); // Board'un içine taşı
        piece.style.position = 'absolute';
        piece.style.left = (positions[toIdx].x - 25) + 'px';
        piece.style.top = (positions[toIdx].y - 25) + 'px';

        // Sayaç güncelleme (Placement phase için)
        if (phase === 'placing' && fromIdx === -1) {
            piecesPlaced[currentPlayer]++;
        }

        // Kazanma Kontrolü
        if (checkWin()) {
            isGameOver = true;
            scores[currentPlayer]++;
            document.getElementById(`score-${currentPlayer === 'R' ? 'red' : 'yellow'}`).innerText = scores[currentPlayer];
            showModal(`${currentPlayer === 'R' ? 'Kırmızı' : 'Sarı'} Kazandı!`);
            return;
        }

        // Faz (Phase) Kontrolü
        checkPhase();

        // Sıra Değiştir
        switchTurn();
    }

    function checkPhase() {
        if (piecesPlaced.R === 3 && piecesPlaced.Y === 3) {
            phase = 'moving';
            // Görsel ipucu verilebilir (isteğe bağlı)
        }
    }

    function checkWin() {
        return winLines.some(line => {
            const [a, b, c] = line;
            return gameState[a] && gameState[a] === gameState[b] && gameState[a] === gameState[c];
        });
    }

    function switchTurn() {
        currentPlayer = currentPlayer === 'R' ? 'Y' : 'R';
        updateTurnDisplay();
    }

    function updateTurnDisplay() {
        const p1d = document.getElementById('p1-display');
        const p2d = document.getElementById('p2-display');
        if (currentPlayer === 'R') {
            p1d.classList.add('active-turn');
            p2d.classList.remove('active-turn');
        } else {
            p2d.classList.add('active-turn');
            p1d.classList.remove('active-turn');
        }
    }

    function showModal(msg) {
        modalMsg.innerText = msg;
        modal.style.display = 'block';
    }

    function resetGame() {
        // State sıfırla
        gameState.fill(null);
        piecesPlaced = { R: 0, Y: 0 };
        isGameOver = false;
        phase = 'placing';
        currentPlayer = 'R';
        
        // Görsel sıfırla
        modal.style.display = 'none';
        createPieces(); // Taşları havuza geri koy
        updateTurnDisplay();
    }

    // Başlat
    init();

</script>
</body>
</html>